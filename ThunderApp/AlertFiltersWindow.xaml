<Window x:Class="ThunderApp.AlertFiltersWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:shell="http://schemas.microsoft.com/winfx/2006/xaml/presentation/shell"
        Title="Alert Filters"
        Width="420" Height="820"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource AppBg}"
        WindowStyle="None"
        ResizeMode="CanResize">

    <!-- MUST be directly under Window -->
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="38"
                            ResizeBorderThickness="6"
                            CornerRadius="0"
                            GlassFrameThickness="0"
                            UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <DockPanel LastChildFill="True">

        <!-- Old school menu stays -->
        <Menu DockPanel.Dock="Top"
              Background="{DynamicResource AppBg}"
              Foreground="{DynamicResource Text}">
            <MenuItem Header="_File">
                <MenuItem Header="_Save" Command="{Binding SaveFiltersCommand}" InputGestureText="Ctrl+S"/>
                <Separator/>
                <MenuItem Header="_Close" Click="Close_Click" InputGestureText="Esc"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Reset Filters" Command="{Binding ResetFiltersCommand}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" />
            </MenuItem>
        </Menu>

        <!-- Custom title bar -->
        <Border DockPanel.Dock="Top"
                Height="38"
                Background="{DynamicResource AppBg}"
                BorderBrush="{DynamicResource Border}"
                BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="150" />
                </Grid.ColumnDefinitions>

                <!-- IMPORTANT: Drag only when click is NOT on a button -->
                <DockPanel Grid.Column="0"
                           LastChildFill="True"
                           MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <TextBlock Text="Alert Filters"
                               FontWeight="SemiBold"
                               FontSize="13"
                               Foreground="{DynamicResource Text}"
                               VerticalAlignment="Center"
                               Margin="12,0,0,0"/>
                </DockPanel>

                <UniformGrid Grid.Column="1"
                             Rows="1"
                             Width="150"
                             HorizontalAlignment="Right"
                             Margin="0,0,6,0"
                             VerticalAlignment="Center">
                    <Button Style="{StaticResource TitleBarButton}"
                            WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="Minimize"
                            Click="Minimize_OnClick">
                        <TextBlock Text="—" FontSize="14" Foreground="{DynamicResource Text}"/>
                    </Button>

                    <Button Style="{StaticResource TitleBarButton}"
                            WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="Maximize"
                            Click="Maximize_OnClick">
                        <TextBlock Text="□" FontSize="12" Foreground="{DynamicResource Text}"/>
                    </Button>

                    <Button Style="{StaticResource TitleBarButton}"
                            WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="Close"
                            Click="Close_OnClick">
                        <TextBlock Text="✕" FontSize="12" Foreground="{DynamicResource Text}"/>
                    </Button>
                </UniformGrid>
            </Grid>
        </Border>

        <!-- Bottom pinned buttons -->
        <Border DockPanel.Dock="Bottom"
                Background="{DynamicResource AppBg}"
                Padding="14">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="10" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Foreground="{DynamicResource Muted}"
                           VerticalAlignment="Center"
                           Text="Ctrl+F opens this window. Esc closes." />

                <Button Grid.Column="1"
                        Style="{StaticResource PrimaryButton}"
                        Width="120"
                        Content="Save"
                        Command="{Binding SaveFiltersCommand}" />

                <Button Grid.Column="3"
                        Width="120"
                        Content="Close"
                        Click="Close_Click" />
            </Grid>
        </Border>

        <!-- Scrollable content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <ScrollViewer.Resources>
                <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource ThinScrollBar}" />
            </ScrollViewer.Resources>

            <Border Style="{StaticResource Card}" Margin="14">
                <StackPanel>

                    <TextBlock FontSize="18" FontWeight="SemiBold" Text="Alert Filters" Margin="0,0,0,10" />

                    <CheckBox Content="Use GPS Location"
                              Style="{StaticResource WfSwitch}"
                              IsChecked="{Binding FilterSettings.UseNearMe}"
                              Margin="0,0,0,10" />

                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="10" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0" ToolTip="Latitude"
                                 Text="{Binding FilterSettings.ManualLat, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBox Grid.Column="2" ToolTip="Longitude"
                                 Text="{Binding FilterSettings.ManualLon, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>

                    <Separator Margin="0,12,0,12" />

                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="10" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="Alert Types" FontWeight="SemiBold" VerticalAlignment="Center" />

                        <Button Grid.Column="1" Content="All On" Padding="10,6"
                                Command="{Binding EnableAllAlertTypesCommand}" />
                        <Button Grid.Column="3" Content="All Off" Padding="10,6"
                                Command="{Binding DisableAllAlertTypesCommand}" />
                    </Grid>

                    <!-- Category chips ONLY control which toggles are visible. They do NOT hide alerts. -->
                    <WrapPanel Margin="0,0,0,10">
                        <Button Content="Severe"    Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Severe" />
                        <Button Content="Tropical"  Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Tropical" />
                        <Button Content="Winter"    Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Winter" />
                        <Button Content="Hydrology" Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Hydrology" />
                        <Button Content="Wind"      Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Wind" />
                        <Button Content="Fire"      Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Fire" />
                        <Button Content="Heat"      Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Heat" />
                        <Button Content="Fog"       Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Fog" />
                        <Button Content="Marine"    Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Marine" />
                        <Button Content="Other"     Style="{StaticResource DashActionButton}" Margin="0,0,10,8"
                                Command="{Binding SetCategoryCommand}" CommandParameter="Other" />
                    </WrapPanel>

                    <ItemsControl ItemsSource="{Binding LifecycleGroups}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="0,0,0,14"
                                            Visibility="{Binding HasVisibleEvents, Converter={StaticResource BoolToVis}}">

                                    <TextBlock Text="{Binding Title}" Foreground="{DynamicResource Muted}"
                                               FontWeight="SemiBold" Margin="0,0,0,8" />

                                    <Border Background="{DynamicResource Surface2}" BorderBrush="{DynamicResource Border}"
                                            BorderThickness="1" CornerRadius="12" Padding="12">

                                        <ItemsControl ItemsSource="{Binding EventsView}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <CheckBox Style="{StaticResource WfSwitch}"
                                                              Content="{Binding EventName}"
                                                              IsChecked="{Binding IsEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Border>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Separator Margin="0,0,0,12" />

                    <TextBlock Text="Severity" FontWeight="SemiBold" Margin="0,0,0,6" />

                    <WrapPanel>
                        <CheckBox Style="{StaticResource WfSwitch}" Content="Extreme"
                                  IsChecked="{Binding FilterSettings.ShowExtreme, UpdateSourceTrigger=PropertyChanged}"
                                  Margin="0,0,12,6" />
                        <CheckBox Style="{StaticResource WfSwitch}" Content="Severe"
                                  IsChecked="{Binding FilterSettings.ShowSevere, UpdateSourceTrigger=PropertyChanged}"
                                  Margin="0,0,12,6" />
                        <CheckBox Style="{StaticResource WfSwitch}" Content="Moderate"
                                  IsChecked="{Binding FilterSettings.ShowModerate, UpdateSourceTrigger=PropertyChanged}"
                                  Margin="0,0,12,6" />
                        <CheckBox Style="{StaticResource WfSwitch}" Content="Minor"
                                  IsChecked="{Binding FilterSettings.ShowMinor, UpdateSourceTrigger=PropertyChanged}"
                                  Margin="0,0,12,6" />
                        <CheckBox Style="{StaticResource WfSwitch}" Content="Unknown"
                                  IsChecked="{Binding FilterSettings.ShowUnknown, UpdateSourceTrigger=PropertyChanged}"
                                  Margin="0,0,12,6" />
                    </WrapPanel>

                </StackPanel>
            </Border>
        </ScrollViewer>

    </DockPanel>
</Window>